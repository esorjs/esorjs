var R=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var D=(t,e)=>()=>(t&&(e=t(t=0)),e);var L=(t,e)=>{for(var n in e)R(t,n,{get:e[n],enumerable:!0})},U=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of G(e))!K.call(t,r)&&r!==n&&R(t,r,{get:()=>e[r],enumerable:!(s=B(e,r))||s.enumerable});return t};var F=t=>U(R({},"__esModule",{value:!0}),t);var z={};L(z,{html:()=>C,renderTemplate:()=>I,renderToString:()=>h,renderValue:()=>g});var Y,S,Z,j,C,f,g,k,I,h,x=D(()=>{"use strict";Y="\uFEFF",S="data-esor-signal",Z="data-esor-handler",j=class{constructor(){this.signals=new Map,this.nextId=0}trackSignal(e){if(!this.signals.has(e)){let n=`s${this.nextId++}`;return this.signals.set(e,{id:n,value:e()}),n}return this.signals.get(e).id}getState(){let e={};for(let[n,{id:s,value:r}]of this.signals)e[s]=r;return e}},C=(t,...e)=>{let n=t.findIndex(o=>o.trim().endsWith("key=")),s,r=[...e];return n!==-1&&(s=e[n],r.splice(n,1)),{strings:t,values:r,_isTemplate:!0,_key:s,_isSSR:!0}},f=t=>t==null?"":String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),g=(t,e)=>{if(t==null||t===!1)return"";if(Array.isArray(t))return t.map(n=>g(n,e)).join("");if(t._isTemplate)return I(t,e);if(t._isSignal){let n=e.trackSignal(t),s=t();return f(s)}return typeof t=="function"?g(t(),e):f(t)},k=(t,e,n)=>{if(t==="ref")return"";if(t.startsWith("on")){let s=t.slice(2).toLowerCase();return` ${Z}="${s}"`}if(t==="style"&&typeof e=="object"&&!Array.isArray(e)){let s=Object.entries(e).map(([r,o])=>`${r.replace(/[A-Z]/g,i=>"-"+i.toLowerCase())}:${o}`).join(";");return` style="${f(s)}"`}if(e?._isSignal){let s=n.trackSignal(e),r=e();return t==="value"||t==="checked"||t==="selected"?` ${t}="${f(r)}" ${S}="${s}:${t}"`:r==null||r===!1?` ${S}="${s}:${t}"`:` ${t}="${f(r===!0?"":r)}" ${S}="${s}:${t}"`}return typeof e=="function"?k(t,e(),n):e===!0?` ${t}`:e===!1||e==null?"":t==="value"||t==="checked"||t==="selected"?` ${t}="${f(e)}"`:` ${t}="${f(e)}"`},I=(t,e)=>{let{strings:n,values:s}=t,r="",o=0;for(let i=0;i<n.length;i++){let l=n[i];if(r+=l.replace(Y,""),i<s.length){let c=s[o++];if(l.trimEnd().endsWith("=")){let a=l.match(/\s+(\w+(?:-\w+)*)=$/);if(a){let p=a[1];r=r.slice(0,-1),r+=k(p,c,e)}}else if(c?._isSignal){let a=e.trackSignal(c),p=c();r+=`<span ${S}="${a}:text">${f(p)}</span>`}else if(typeof c=="function"){let a=c();if(a?._isSignal){let p=e.trackSignal(a),W=a();r+=`<span ${S}="${p}:text">${f(W)}</span>`}else r+=g(a,e)}else r+=g(c,e)}}return r},h=t=>{if(!t||!t._isTemplate)throw new Error("renderToString expects a template created with html``");let e=new j,n=I(t,e),s=e.getState();return{html:n,state:s}}});var P={};L(P,{STATE_SCRIPT_ID:()=>O,createStateScript:()=>V,deserializeValue:()=>m,getStateFromPage:()=>$,injectState:()=>w,serializeValue:()=>y});var O,y,m,V,$,w,_=D(()=>{"use strict";O="__ESOR_STATE__",y=t=>{if(t===void 0)return"undefined";if(t===null||typeof t=="function"||typeof t=="symbol")return"null";if(t instanceof Date)return JSON.stringify({__type:"Date",value:t.toISOString()});if(t instanceof RegExp)return JSON.stringify({__type:"RegExp",source:t.source,flags:t.flags});if(Array.isArray(t))return"["+t.map(y).join(",")+"]";if(typeof t=="object"){let e=[];for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(JSON.stringify(n)+":"+y(t[n]));return"{"+e.join(",")+"}"}return JSON.stringify(t)},m=t=>{if(t==null)return t;if(typeof t=="object"){if(t.__type==="Date")return new Date(t.value);if(t.__type==="RegExp")return new RegExp(t.source,t.flags);if(Array.isArray(t))return t.map(m);let e={};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=m(t[n]));return e}return t},V=t=>{let e=y(t);return`<script id="${O}" type="application/json">${e}</script>`},$=()=>{if(typeof document>"u")return null;let t=document.getElementById(O);if(!t)return null;try{let e=JSON.parse(t.textContent);return m(e)}catch(e){return console.error("Failed to parse SSR state:",e),null}},w=(t,e,n="body")=>{let s=V(e);return n==="head"?t.replace("</head>",`${s}
</head>`):t.includes("</body>")?t.replace("</body>",`${s}
</body>`):t+s}});x();var E=null,b=0,u=null,H=!1;function N(){for(H=!1;u;){let t=u;u=null;for(let e of t)e()}}var J=t=>{let e=t,n=new Set,s=(...r)=>{if(!r.length)return E&&n.add(E),e;let o=r[0];if(e!==o)if(e=o,b){u||(u=new Set);for(let i of n)u.add(i)}else{u||(u=new Set);for(let i of n)u.add(i);H||(H=!0,queueMicrotask(N))}return e};return s._isSignal=!0,s},A=t=>{let e=()=>{E=e,t(),E=null};return e(),e},Q=t=>{let e=J(void 0);return A(()=>e(t())),e},X=t=>{b++;let e=t();return!--b&&u&&N(),e},v=t=>{b++;let e=t();return b--,u&&N(),e};_();var T="data-esor-signal",q="data-esor-handler",M=(t,e,n)=>{let s=t.querySelectorAll(`[${T}]`);for(let r of s){let o=r.getAttribute(T),[i,l]=o.split(":"),c=e[i];if(!c){console.warn(`Signal ${i} not found in signal map`);continue}n&&i in n&&c(n[i]),l==="text"?A(()=>{r.textContent=c()}):A(()=>{let d=c();l==="value"||l==="checked"||l==="selected"?r[l]=d:d==null||d===!1?r.removeAttribute(l):r.setAttribute(l,d===!0?"":d)}),r.removeAttribute(T)}},tt=(t,e)=>{if(!e)return;let n=t.querySelectorAll(`[${q}]`);for(let s of n){let r=s.getAttribute(q),o=e[r];o&&typeof o=="function"&&(s.addEventListener(r,o),s._cleanup||(s._cleanup=()=>s.removeEventListener(r,o))),s.removeAttribute(q)}},et=(t,e={})=>{let n=typeof t=="string"?document.querySelector(t):t;if(!n)throw new Error(`Hydration target not found: ${t}`);let s=e.state??$();e.signals&&M(n,e.signals,s),e.handlers&&tt(n,e.handlers)},nt=t=>function(e){let n=t.call(this,e);if(this.shadowRoot?.querySelector(`[${T}]`)!==void 0){if(this._signals){let r=$();M(this.shadowRoot,this._signals,r)}return n}return n},rt=()=>typeof document>"u"?!1:document.querySelector(`[${T}]`)!==null||$()!==null;x();_();var st=(t,e={})=>{let{title:n="Esor App",lang:s="en",head:r="",bodyAttrs:o=""}=e,{html:i,state:l}=h(t),c=`<!DOCTYPE html>
<html lang="${s}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${n}</title>
    ${r}
</head>
<body${o?" "+o:""}>
    ${i}
</body>
</html>`;return w(c,l,"body")},ot=t=>{let{renderToString:e}=(x(),F(z));return new ReadableStream({start(n){try{let{html:s,state:r}=e(t),o=new TextEncoder;n.enqueue(o.encode(s));let{createStateScript:i}=(_(),F(P));n.enqueue(o.encode(i(r))),n.close()}catch(s){n.error(s)}}})};_();export{X as batch,Q as computed,nt as createHydratableComponent,V as createStateScript,m as deserializeValue,A as effect,v as flushSync,C as html,et as hydrate,w as injectState,rt as isSSRContent,st as renderToHTML,ot as renderToStream,h as renderToString,y as serializeValue,J as signal};
//# sourceMappingURL=esor-ssr.js.map
